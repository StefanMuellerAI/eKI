# Production Docker Compose Configuration
# Use: docker compose -f docker-compose.yml -f docker-compose.prod.yml up -d

services:
  postgres:
    environment:
      POSTGRES_PASSWORD_FILE: /run/secrets/db_password
    ports: []
    secrets:
      - db_password

  redis:
    ports: []

  temporal:
    environment:
      - POSTGRES_PWD_FILE=/run/secrets/db_password
    ports: []
    secrets:
      - db_password

  temporal-ui:
    ports: []

  ollama:
    ports: []

  api:
    environment:
      - ENV=production
      - DEBUG=false
      - DATABASE_URL_FILE=/run/secrets/database_url
      - API_SECRET_KEY_FILE=/run/secrets/api_secret_key
    env_file:
      - .env.local
    secrets:
      - database_url
      - api_secret_key
    # Remove development volume mounts for production
    volumes: []

  worker:
    environment:
      - ENV=production
      - DEBUG=false
      - DATABASE_URL_FILE=/run/secrets/database_url
      - API_SECRET_KEY_FILE=/run/secrets/api_secret_key
    env_file:
      - .env.local
    secrets:
      - database_url
      - api_secret_key
    # Remove development volume mounts for production
    volumes: []

secrets:
  db_password:
    file: ./secrets/db_password.txt
  database_url:
    file: ./secrets/database_url.txt
  api_secret_key:
    file: ./secrets/api_secret_key.txt
