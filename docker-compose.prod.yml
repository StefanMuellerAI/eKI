# Production Docker Compose Configuration
# Use: docker compose -f docker-compose.yml -f docker-compose.prod.yml up -d

services:
  postgres:
    # POSTGRES_PASSWORD comes from .env.local (env_file in base compose)
    # Do NOT use POSTGRES_PASSWORD_FILE here -- it conflicts with POSTGRES_PASSWORD
    ports: []

  redis:
    ports: []

  temporal:
    # POSTGRES_PWD comes from .env.local (env_file in base compose)
    ports: []

  temporal-ui:
    ports: []

  ollama:
    ports: []

  api:
    environment:
      - ENV=production
      - DEBUG=false
      - DATABASE_URL_FILE=/run/secrets/database_url
      - API_SECRET_KEY_FILE=/run/secrets/api_secret_key
    env_file:
      - .env.local
    secrets:
      - database_url
      - api_secret_key
    # Remove development volume mounts for production
    volumes: []

  worker:
    environment:
      - ENV=production
      - DEBUG=false
      - DATABASE_URL_FILE=/run/secrets/database_url
      - API_SECRET_KEY_FILE=/run/secrets/api_secret_key
    env_file:
      - .env.local
    secrets:
      - database_url
      - api_secret_key
    # Remove development volume mounts for production
    volumes: []

secrets:
  db_password:
    file: ./secrets/db_password.txt
  database_url:
    file: ./secrets/database_url.txt
  api_secret_key:
    file: ./secrets/api_secret_key.txt
